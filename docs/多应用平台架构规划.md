# 多应用学习平台架构规划

## 一、架构概述

### 1.1 核心理念

想象一下，你正在建造一个"学习应用商城"：
- **每个应用** = 一个独立的"店铺"（可以单独开门营业）
- **应用中心** = 一个"商场"（所有店铺集中在一起，可以互相切换）
- **共享组件库** = "商场的基础设施"（统一的装修风格、统一的收银系统等）

### 1.2 架构模式

采用 **"微前端 + 共享库"** 架构：

```
┌─────────────────────────────────────────┐
│         应用中心（Shell/Portal）          │
│  ┌──────────┐  ┌──────────┐  ┌────────┐ │
│  │ 应用A    │  │ 应用B    │  │ 应用C  │ │
│  │ (看拼音)  │  │ (加减法)  │  │ (听写) │ │
│  └──────────┘  └──────────┘  └────────┘ │
└─────────────────────────────────────────┘
              ↓ 共享 ↓
┌─────────────────────────────────────────┐
│        共享组件库（Shared Library）      │
│  - UI组件（导航、按钮、卡片等）          │
│  - 样式系统（主题、颜色、字体等）        │
│  - 工具函数（API调用、存储、工具等）     │
│  - 业务组件（错题本、统计、设置等）      │
└─────────────────────────────────────────┘
```

## 二、目录结构设计

### 2.1 推荐结构（方案A：单仓库多应用）

```
learning-platform/                    # 平台根目录
├── apps/                             # 应用目录
│   ├── pinyin-write/                 # 看拼音写词（当前应用）
│   │   ├── index.html
│   │   ├── js/
│   │   │   ├── app.js               # 应用入口
│   │   │   ├── practice.js          # 应用特有逻辑
│   │   │   └── ...
│   │   ├── css/
│   │   │   └── app.css              # 应用特有样式
│   │   └── README.md
│   ├── math-practice/                # 加减法练习
│   │   └── ...
│   ├── word-dictation/               # 单词听写
│   │   └── ...
│   └── word-reading/                 # 单词认读
│       └── ...
│
├── shared/                           # 共享资源库
│   ├── components/                   # 共享UI组件
│   │   ├── navbar/                   # 导航栏组件
│   │   │   ├── navbar.js
│   │   │   └── navbar.css
│   │   ├── errorbook/                # 错题本组件
│   │   │   ├── errorbook.js
│   │   │   └── errorbook.css
│   │   ├── statistics/               # 统计组件
│   │   ├── settings/                 # 设置组件
│   │   └── app-switcher/             # 应用切换器
│   │       ├── app-switcher.js
│   │       └── app-switcher.css
│   │
│   ├── styles/                       # 共享样式系统
│   │   ├── tokens.css                # 设计令牌（颜色、字体等）
│   │   ├── theme.css                 # 主题系统（深色/浅色）
│   │   ├── components.css            # 组件基础样式
│   │   └── utilities.css             # 工具类
│   │
│   ├── utils/                        # 工具函数库
│   │   ├── api/                      # API调用封装
│   │   │   ├── base.js               # 基础请求
│   │   │   ├── recognition.js       # 识别API
│   │   │   └── storage.js            # 存储API
│   │   ├── storage/                  # 存储工具
│   │   │   └── localStorage.js
│   │   ├── router/                   # 路由工具
│   │   │   └── router.js
│   │   └── helpers/                  # 辅助函数
│   │       ├── format.js
│   │       └── validation.js
│   │
│   └── config/                       # 共享配置
│       ├── apps.json                 # 应用列表配置
│       └── api-config.js             # API配置
│
├── portal/                           # 应用中心（可选）
│   ├── index.html                    # 入口页面
│   ├── js/
│   │   └── portal.js                 # 应用中心逻辑
│   └── css/
│       └── portal.css
│
├── docs/                             # 文档
│   ├── 架构说明.md
│   ├── 开发指南.md
│   └── API文档.md
│
├── package.json                      # 项目配置
└── README.md                         # 项目说明
```

### 2.2 方案B：多仓库独立部署（适合后期）

如果应用需要完全独立部署，可以：
- 每个应用一个独立的Git仓库
- 共享库作为npm包或CDN资源
- 应用中心通过iframe或模块加载方式集成

## 三、核心组件设计

### 3.1 应用切换器（App Switcher）

**功能**：在应用之间切换导航

**位置**：
- 方案1：左侧边栏（类似VS Code）
- 方案2：右上角应用菜单（类似Google）

**实现方式**：
```javascript
// shared/components/app-switcher/app-switcher.js
class AppSwitcher {
    constructor() {
        this.apps = [
            { id: 'pinyin', name: '看拼音写词', icon: 'bi-pencil-square', path: '/apps/pinyin-write/' },
            { id: 'math', name: '加减法练习', icon: 'bi-calculator', path: '/apps/math-practice/' },
            { id: 'dictation', name: '单词听写', icon: 'bi-mic', path: '/apps/word-dictation/' },
            { id: 'reading', name: '单词认读', icon: 'bi-book', path: '/apps/word-reading/' }
        ];
    }
    
    render() {
        // 渲染应用列表
    }
    
    switchApp(appId) {
        // 切换到指定应用
    }
}
```

### 3.2 共享导航栏（Navbar）

**功能**：统一的顶部导航栏

**特性**：
- 应用切换器入口
- 主题切换
- 用户设置
- 调试模式

**使用方式**：
```javascript
// 在应用中使用
import { Navbar } from '../../shared/components/navbar/navbar.js';
const navbar = new Navbar({
    appName: '看拼音写词',
    showAppSwitcher: true
});
navbar.render('#navbar-container');
```

### 3.3 设计令牌系统（Design Tokens）

**功能**：统一的设计变量

**文件**：`shared/styles/tokens.css`

```css
:root {
    /* 颜色系统 */
    --color-primary: #0d6efd;
    --color-success: #198754;
    --color-danger: #dc3545;
    --color-warning: #ffc107;
    
    /* 字体系统 */
    --font-family-base: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    --font-size-base: 1rem;
    --font-size-lg: 1.25rem;
    --font-size-sm: 0.875rem;
    
    /* 间距系统 */
    --spacing-xs: 0.25rem;
    --spacing-sm: 0.5rem;
    --spacing-md: 1rem;
    --spacing-lg: 1.5rem;
    
    /* 圆角系统 */
    --border-radius-sm: 0.25rem;
    --border-radius-md: 0.5rem;
    --border-radius-lg: 1rem;
    
    /* 阴影系统 */
    --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
    --shadow-md: 0 4px 6px rgba(0,0,0,0.1);
}

[data-theme="dark"] {
    --color-bg: #1a1a1a;
    --color-text: #ffffff;
    /* ... */
}
```

### 3.4 统一API调用

**功能**：封装所有API调用

**文件**：`shared/utils/api/base.js`

```javascript
class ApiClient {
    constructor(config) {
        this.baseURL = config.baseURL || '';
        this.timeout = config.timeout || 10000;
    }
    
    async request(endpoint, options = {}) {
        // 统一请求处理
        // - 添加认证头
        // - 错误处理
        // - 超时处理
        // - 日志记录
    }
    
    async get(url, params) { }
    async post(url, data) { }
    async put(url, data) { }
    async delete(url) { }
}

// 识别API封装
class RecognitionAPI extends ApiClient {
    async recognize(imageData) {
        // 调用识别API
    }
}
```

### 3.5 共享业务组件

#### 3.5.1 错题本组件

**功能**：通用的错题管理组件

**特性**：
- 可配置的数据结构
- 统一的UI样式
- 支持不同题型的展示

**使用方式**：
```javascript
import { ErrorBook } from '../../shared/components/errorbook/errorbook.js';

const errorBook = new ErrorBook({
    dataAdapter: (item) => ({
        id: item.id,
        question: item.question,
        answer: item.answer,
        userAnswer: item.userAnswer,
        snapshot: item.snapshot
    })
});
```

#### 3.5.2 统计组件

**功能**：统一的统计展示

**特性**：
- 可配置的统计指标
- 统一的图表样式
- 数据导出功能

## 四、实施步骤

### 阶段一：准备共享库（1-2周）

**目标**：提取当前应用的通用部分

**步骤**：

1. **创建共享库目录结构**
   ```bash
   mkdir -p shared/{components,styles,utils,config}
   ```

2. **提取设计令牌**
   - 从 `css/styles.css` 提取颜色、字体、间距等变量
   - 创建 `shared/styles/tokens.css`

3. **提取通用组件**
   - 导航栏 → `shared/components/navbar/`
   - 错题本 → `shared/components/errorbook/`
   - 统计 → `shared/components/statistics/`

4. **提取工具函数**
   - API调用 → `shared/utils/api/`
   - 存储 → `shared/utils/storage/`
   - 路由 → `shared/utils/router/`

5. **重构当前应用**
   - 将 `看拼音写词` 移动到 `apps/pinyin-write/`
   - 修改引用路径，使用共享库

### 阶段二：创建应用中心（1周）

**目标**：实现应用切换功能

**步骤**：

1. **创建应用配置**
   ```json
   // shared/config/apps.json
   {
       "apps": [
           {
               "id": "pinyin",
               "name": "看拼音写词",
               "icon": "bi-pencil-square",
               "path": "/apps/pinyin-write/",
               "description": "通过拼音练习汉字书写"
           }
       ]
   }
   ```

2. **开发应用切换器组件**
   - 左侧边栏版本
   - 右上角菜单版本

3. **创建应用中心页面**
   - `portal/index.html`
   - 实现应用加载和切换逻辑

### 阶段三：开发第二个应用（2-3周）

**目标**：验证架构可行性

**步骤**：

1. **选择应用**（建议从简单的开始，如加减法练习）

2. **创建应用目录**
   ```bash
   mkdir -p apps/math-practice/{js,css}
   ```

3. **使用共享组件**
   - 使用共享导航栏
   - 使用共享错题本
   - 使用共享统计组件

4. **开发应用特有功能**
   - 题目生成逻辑
   - 答题交互
   - 结果判断

### 阶段四：优化和完善（持续）

**目标**：完善共享库，优化开发体验

**步骤**：

1. **完善文档**
   - 组件使用文档
   - API文档
   - 开发指南

2. **开发工具**
   - 应用脚手架（快速创建新应用）
   - 构建脚本

3. **测试和优化**
   - 性能优化
   - 兼容性测试

## 五、技术选型建议

### 5.1 当前技术栈（保持）

- **前端框架**：原生JavaScript（轻量，易维护）
- **UI框架**：Bootstrap 5
- **构建工具**：无需（或使用简单的脚本）

### 5.2 可选增强

- **模块化**：ES6 Modules（浏览器原生支持）
- **打包工具**（可选）：Vite / Rollup（如果应用变复杂）
- **类型检查**（可选）：JSDoc注释

## 六、部署方案

### 6.1 单仓库部署

**方案**：所有应用部署在同一域名下

```
https://learning-platform.com/
├── apps/
│   ├── pinyin-write/      # 独立访问
│   ├── math-practice/     # 独立访问
│   └── ...
├── portal/                 # 应用中心
└── shared/                 # 共享资源（CDN）
```

**优点**：
- 简单，易于管理
- 共享资源加载快

**缺点**：
- 所有应用耦合在一起

### 6.2 多仓库独立部署

**方案**：每个应用独立部署，共享库通过CDN加载

```
https://pinyin-write.com/          # 应用A
https://math-practice.com/         # 应用B
https://cdn.learning-platform.com/ # 共享库CDN
```

**优点**：
- 完全独立
- 可以独立更新

**缺点**：
- 部署复杂
- 需要CDN管理

## 七、开发工作流

### 7.1 创建新应用

```bash
# 1. 创建应用目录
mkdir -p apps/new-app/{js,css}

# 2. 创建基础文件
cp apps/pinyin-write/index.html apps/new-app/
# 修改引用路径

# 3. 使用共享组件
import { Navbar } from '../../shared/components/navbar/navbar.js';
import { ErrorBook } from '../../shared/components/errorbook/errorbook.js';
```

### 7.2 更新共享组件

1. 在 `shared/` 目录下修改
2. 所有使用该组件的应用自动获得更新
3. 注意向后兼容

### 7.3 版本管理

- 共享库使用语义化版本（如 v1.0.0）
- 每个应用独立版本号
- 在应用配置中指定依赖的共享库版本

## 八、常见问题

### Q1: 如何确保应用可以独立运行？

**A**: 每个应用都有完整的 `index.html`，可以单独打开。共享库通过相对路径引用，如果部署在同一服务器下，可以正常工作。

### Q2: 如何避免样式冲突？

**A**: 
- 使用CSS变量（设计令牌）
- 组件样式使用作用域（BEM命名或CSS Modules）
- 应用特有样式使用应用前缀

### Q3: 如何管理不同应用的数据？

**A**: 
- 使用 `localStorage` 时，每个应用使用独立的前缀
- 例如：`pinyin_practice_logs`, `math_practice_logs`

### Q4: 共享库更新会影响现有应用吗？

**A**: 
- 尽量保持向后兼容
- 重大更新时，提供迁移指南
- 可以考虑版本化共享库

## 九、下一步行动

1. **立即开始**：创建 `shared/` 目录，提取当前应用的通用部分
2. **逐步迁移**：将 `看拼音写词` 重构为使用共享库
3. **验证架构**：开发第二个简单应用（如加减法）
4. **完善文档**：记录开发过程中的经验和问题

---

*文档版本：v1.0*  
*最后更新：2025-11-04*

